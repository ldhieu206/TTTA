{% extends "home/hocVien/baseHV.html" %} 
{% block title %} Tài Khoản Học Viên
{%endblock title %} 
{% block content %}
<div class= " content-wrapper">
  <section class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1>Thông tin học viên</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Trang chủ</a></li>
            <li class="breadcrumb-item active">Thông tin học viên</li>
          </ol>
        </div>
      </div>
    </div>
  </section>
  <section class="content">

      <!-- Default box -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Thông tin học viên</h3>

        <div class="card-tools">
          <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
            <i class="fas fa-minus"></i>
          </button>
          <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3">
            <div class="card card-primary">
              <div class="card-header">
                <h3 class="card-title">Ảnh đại diện</h3>
              </div>
              <div class="card-body">
                <div class="text-center">
                  <img src="/media/images/info.jpg" class="img-responsive" alt="" class="img-fluid">
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-9">
            <div class="card card-primary">
              <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                  <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Thông tin học viên</button>
                  <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">Thông tin phụ huynh</button>
                  <button class="nav-link" id="nav-contact-tab" data-bs-toggle="tab" data-bs-target="#nav-contact" type="button" role="tab" aria-controls="nav-contact" aria-selected="false">Thông tin lớp học</button>
                </div>
              </nav>
              <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab" tabindex="0">
                  <div class="col-md-9">
                    <div class="card card-primary">
                      <div class="card-body">
                        <div class="form-group">
                          <label for="">Họ và tên</label>
                          <input type="text" class="form-control" value="{{hocVien.name}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Email</label>
                          <input type="text" class="form-control" value="{{hocVien.email}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Số điện thoại</label>
                          <input type="text" class="form-control" value="{{hocVien.phone}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Địa chỉ</label>
                          <input type="text" class="form-control" value="{{hocVien.diaChi}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Ngày sinh</label>
                          <input type="text" class="form-control" value="{{hocVien.ngaySinh|date:"d-m-Y" }}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Giới tính</label>
                          <input type="text" class="form-control" value="{{hocVien.gioiTinh}}" disabled>
                        </div>
                      </div>
                    </div>
                    </div>
                </div>
                <div class="tab-pane fade show-active" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab" tabindex="0">
                  <div class="col-md-9">
                    <div class="card card-primary">
                      <div class="card-body">
                        <div class="form-group">
                          <label for="">Họ và tên</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.tenPH}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Email</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.email}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Số điện thoại</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.sdt1}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Số Zalo</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.soZalo}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Ngày sinh</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.ngaySinh|date:"d-m-Y"}}" disabled>
                        </div>
                        <div class="form-group">
                          <label for="">Giới tính</label>
                          <input type="text" class="form-control" value="{{phuHuynhs.gioiTinh}}" disabled>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab" tabindex="0">
                  <div class="card-body">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                          <th>Mã Lớp Học</th>
                          <th>Mã Giáo Viên</th>
                          <th>Ngày Bắt Đầu</th>
                          <th>Ngày Kết Thúc</th>
                          <th>Học Phí Ca</th>
                          <th>Học Phí Đợt</th>
                        </tr>
                      </thead>
                      <tbody>
                        <input id="mlh" type="hidden" value="">

                        {% for item in lopHocs %}
                        <tr>
                          <td>{{ item.maLop }}</td>
                          <td>{{ item.giaoVien_id }}</td>
                          <td>{{ item.ngayBatDau|date:"d-m-Y" }}</td>
                          <td>{{ item.ngayKetThuc|date:"d-m-Y" }}</td>
                          <td class="hocPhi_ca">{{ item.hocPhi_ca }}</td>
                          <td class="hocPhi_dot">{{ item.hocPhi_dot }}</td>
                        </tr>

                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- Modal -->
<div class="modal fade" id="dongTien" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  {% csrf_token %}
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Đóng tiền</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="">Số tiền phải đóng</label>
          <input type="number" class="form-control"  id="soTienPhaiDong" value="" disabled>
        </div>
        <div class="form-group">
          <label for="">Số tiền đóng</label>
          <input type="number" class="form-control" id="soTienDong" onkeyup="myFunc();">
        </div>
        <div class="form-group">
          <label for="">Ngày đóng</label>
          <input type="date" class="form-control" id="ngay" value="" >
        </div>
        <div class="form-group">
          <label for="">Số tiền còn phải thanh toán </label>
          <input type="number" class="form-control" id="soChuaThanhToan" disabled>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
        <button type="submit" onclick="dongTien()" class="btn btn-primary">Đóng tiền</button>
      </div>
    </div>
  </div>
</div>
</div>
  <script>

    function myFunc(){
      var a = document.getElementById("soTienPhaiDong").value;
      var x = document.getElementById("soTienDong").value;
      var y = document.getElementById("soChuaThanhToan");
      y.value =  a - x;
    }

    const triggerTabList = document.querySelectorAll("#myTab a");
    triggerTabList.forEach((triggerEl) => {
      const tabTrigger = new bootstrap.Tab(triggerEl);

      triggerEl.addEventListener("click", (event) => {
        event.preventDefault();
        tabTrigger.show();
      });
    });

    function modal(maLop,hocPhi_dot){
      $('#dongTien').modal('show');
      $('#mlh').val(maLop);
      $('#soTienPhaiDong').val(hocPhi_dot);
    }


    function dongTien(){
      var maLop = $('#mlh').val();
      var payload = new FormData();
      payload.append("soTienDong",soTienDong);
      payload.append("ngay",ngay);
      payload.append("soChuaThanhToan",soChuaThanhToan);
      payload.append("csrfmiddlewaretoken",$("input[name=csrfmiddlewaretoken]").val());
      $.ajax({
        url: "/dongTien/",
        type: "POST",
        data: payload,
        processData: false,
        contentType: false,
        success: function (data) {
          alert("Đóng tiền thành công");
        },
        error: function (data) {
          alert("Đóng tiền thất bại");
        },
      });
    }
    document.getElementById("ngay").value = new Date().toISOString().split('T')[0];
  </script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>
    function editHocVien(){
      const payload = new FormData();
      payload.append("name",name);
      payload.append("gioiTinh",gioiTinh);
      payload.append("ngaySinh",ngaySinh);
      payload.append("diaChi",diaChi);
      payload.append("phone",phone);
      payload.append("email",email);
      payload.append(
        "csrfmiddlewaretoken",
        $("input[name=csrfmiddlewaretoken]").val()
      );
    $.ajax({
      url: "/editHocVien/",
      type: "POST",
      data: payload,
      processData: false,
      contentType: false,
      success: function (data) {
        alert("Sửa thành công");
      },
      error: function (data) {
        alert("Sửa thất bại");
      },
    });
    }



    function numberWithCommas(y) {
  let res = '';
  while (y > 0) {
    res = ',' + String(y % 1000).padStart(3, '0') + res;
    y = Math.floor(y / 1000);
  }
  res = res.substr(1);
  while (res[0] == '0') {
    res = res.substr(1);
  }
  return res;
}
Object.values(document.getElementsByClassName("soChuaThanhToan")).forEach((item) => {
  item.innerHTML = numberWithCommas(item.innerHTML) + ' VNĐ';
});

Object.values(document.getElementsByClassName("soTienDong")).forEach((item) => {
  item.innerHTML = numberWithCommas(item.innerHTML) + ' VNĐ';
});
Object.values(document.getElementsByClassName("hocPhi_ca")).forEach((item) => {
  item.innerHTML = numberWithCommas(item.innerHTML) + ' VNĐ';
});
Object.values(document.getElementsByClassName("hocPhi_dot")).forEach((item) => {
  item.innerHTML = numberWithCommas(item.innerHTML) + ' VNĐ';
});
  </script>
</div>

{% endblock content %}
